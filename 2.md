让我直接分析错误信息和代码来理解问题的根本原因：

Prometheus 指标重复注册问题的根本原因：

从错误堆栈可以看出：

错误发生位置：github.com/prometheus/client_golang/prometheus.(*Registry).MustRegister
调用链：
orbit.NewEngine()
orbit.(*Engine).registerBuiltinServices()
orbit.(*Engine).setupMetricService()
orbit/internal/metric.(*ServerMetrics).Register()
prometheus.(\*Registry).MustRegister()
问题分析：

orbit 库的设计：orbit 库在每次调用 orbit.NewEngine() 时，都会自动注册 Prometheus 指标到全局默认注册表
我们的代码结构：
NewServer() 创建一个 Server 实例
NewServer() 调用 NewForwardServer() 创建转发服务器 → 调用 orbit.NewEngine()
NewServer() 调用 NewAdminServer() 创建管理服务器 → 调用 orbit.NewEngine()
冲突原因：
第一次调用 orbit.NewEngine() 时，成功注册指标到全局注册表
第二次调用 orbit.NewEngine() 时，尝试注册相同名称的指标，导致 duplicate metrics collector registration attempted 错误
测试中的问题：
在测试中，每个测试函数都会创建新的 Server 实例
即使在不同的测试函数中，它们运行在同一个进程中，共享全局的 Prometheus 注册表
第一个测试成功注册指标，后续测试尝试注册相同指标时失败
解决方案：

最根本的解决方案：修改 orbit 库，让它支持自定义 Prometheus 注册表，或者提供禁用指标注册的选项
当前可行的解决方案：
在测试中只创建一个服务器实例，避免多次调用 orbit.NewEngine()
将不同的测试分离到不同的测试进程中运行
使用构建标签来控制测试的运行
临时解决方案：
在测试开始时清理 Prometheus 的全局注册表（但这可能影响其他测试）
